<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://spike.ist/main.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" href="https://spike.ist/assets/spike-favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> SPIKE | SPIKE Backup and Restore </title>
</head>
<body>

<main>
    
    <nav>
  <script>
    fetch('https://api.github.com/repos/spiffe/spike/releases/latest')
        .then(response => response.json())
        .then(data => {
            const release = document.getElementById('release');
            const icon = '<i class="bx bx-package"></i>';
            release.href = data.name ? data.html_url : 'https://api.github.com/repos/spiffe/spike/releases';
            release.innerHTML = icon + (data.name ? ' ' + data.name : ' Releases');
        });
</script>
<div id="banner">
    <a href="https://spike.ist">
        <img src="https://spike.ist/assets/spike-banner.png" alt="logo" />
    </a>
    <div id="banner-body">
        <a class="banner-title" href="https://spike.ist">
            SPIKE
        </a>
        <span class="banner-tagline">
            Secure your secrets<br> with SPIFFE.
        </span>
        <a id="release" class="banner-link" href="https://github.com/spiffe/spike/releases">
            <i class='bx bx-package'></i>
        </a>
        <a href="https://github.com/spiffe/spike" class="banner-link">
            <i class='bx bxl-github'></i> GitHub
        </a>

    </div>
</div>
<style>
   /* Banner on top of the nav */
   #banner {
        position: sticky;
        background-color: var(--bg-primary);
        z-index: 100;
        top: 0;
        display: flex;
        flex-direction: row;
        padding: 1rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
    }

    #banner img {
        width: 100px;
        height: auto;
    }

    #banner-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        margin-left: 1rem;
    }

    .banner-title {
        font-size: 1.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        margin-bottom: -15px;
        font-family: var(--brand-font-family);
    }
    .banner-tagline {
        font-size: 0.875rem;
        color: var(--text-muted);
        font-style: italic;
    }

    .banner-link {
        display: flex;
        gap: 0.5rem;
        min-width: 84px;
        font-size: 0.875rem;
        font-weight: 300;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        background-color: var(--bg-interactive);
        transition: all 0.2s ease;
    }

    .banner-link i {
        font-size: 1.125rem;
        color: var(--spike-blue);
    }

    .banner-link:hover {
        background-color: var(--spike-blue);
    }
</style> <div id="trees">
    <input class="tree-toggle" type="checkbox" id="getting-started"
               />
        <label class="tree-toggle-label "
               for="getting-started">Getting Started</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/getting-started/about/">About SPIKE</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/project-status/">Project Maturity</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/quickstart/">SPIKE Quickstart Guide</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/local-deployment/">Building SPIKE Locally</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/bare-metal/">SPIKE on Linux</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/configuration/">Configuring SPIKE</a>
                </li>

                <li >
                    <a href="https://spike.ist/getting-started/cli/">SPIKE CLI</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="community"
               />
        <label class="tree-toggle-label "
               for="community">Community</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/community/hello/">Hello Universe</a>
                </li>

                <li >
                    <a href="https://spike.ist/community/contact/">Contact Us</a>
                </li>

                <li >
                    <a href="https://spike.ist/community/presentations/">Presentations and Demos</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="spike-architecture"
               />
        <label class="tree-toggle-label "
               for="spike-architecture">SPIKE Architecture</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/architecture/system-overview/">System Overview</a>
                </li>

                <li >
                    <a href="https://spike.ist/architecture/security-model/">SPIKE Security Model</a>
                </li>

                <li >
                    <a href="https://spike.ist/architecture/architectural-decision-records/">ADRs</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="tracking"
               />
        <label class="tree-toggle-label "
               for="tracking">Tracking</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/tracking/changelog/">Changelog</a>
                </li>

                <li >
                    <a href="https://spike.ist/tracking/snapshots/">Documentation Snapshots</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="operations"
               checked/>
        <label class="tree-toggle-label "
               for="operations">Operations</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/operations/build/">SPIKE Cross-Platform Build</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/production/">SPIKE Production Setup</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/recovery/">SPIKE Recovery Procedures</a>
                </li>

                <li class="active">
                    <a href="https://spike.ist/operations/backup/">SPIKE Backup and Restore</a>
                </li>

                
                        
                        
                            <ul id="toc">
                                <li><a href="
                                            https://spike.ist/operations/backup/#spike-backup-and-restore-guide">SPIKE Backup and Restore Guide</a>
                                        <ul>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#architecture-foundations-for-effective-backup-planning">Architecture Foundations for Effective Backup Planning</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#backup-procedures">Backup procedures</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#restore-procedures">Restore procedures</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#backup-best-practices">Backup best practices</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#migration-limitations-and-planning">Migration Limitations and Planning</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/operations/backup/#conclusion">Conclusion</a>
                                                    </li>
                                                </ul>
                                        </li>
                                </ul>
                        <li >
                    <a href="https://spike.ist/operations/release/">SPIKE Relase Management</a>
                </li>

                </ul>
    </div>
<style>
    /* Navigation tree structure */
    #trees {
        padding: 0 1rem;
    }

    .tree-toggle {
        display: none;
    }

    .tree-toggle:checked + .tree-toggle-label + .subtree {
        display: block;
    }

    .tree-toggle-label {
        display: block;
        padding: 0.75rem 1rem;
        margin: 0.25rem 0;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .tree-toggle-label:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .tree-toggle-label::before {
        content: '▸';
        display: inline-block;
        margin-right: 0.5rem;
        transition: transform 0.2s ease;
    }

    .tree-toggle:checked + .tree-toggle-label::before {
        transform: rotate(90deg);
    }

    .subtree {
        display: none;
        margin: 0;
        padding: 0 0 0 1rem;
        list-style: none;
    }

    .subtree li {
        margin: 0.25rem 0;
    }

    .subtree li a {
        display: block;
        padding: 0.5rem 1rem;
        text-decoration: none;
        border-radius: 4px;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
    }

    .subtree li a:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .subtree li.active a {
        font-weight: 600;
        background-color: rgba(0, 0, 0, 0.05);
    }

    /* Table of contents styling */
    #toc {
        margin: 0.5rem 0 0.5rem 1.5rem;
        padding: 0;
        list-style: none;
        font-size: 0.875rem;
    }

    #toc li {
        margin: 0.25rem 0;
    }

    #toc li a {
        padding: 0.375rem 0.75rem;
        opacity: 0.8;
    }

    #toc li a:hover {
        opacity: 1;
    }

    #toc ul {
        margin: 0.25rem 0 0.25rem 1rem;
        padding: 0;
        list-style: none;
    }
</style>
</nav>
<style>
  nav {
    position: sticky;
    width: 300px;
    height: 100vh;
    top: 0;
    max-height: 100vh;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
    z-index: 100;
    box-shadow: 5px 0 20px var(--shadow-color);
    border-right: 1px solid var(--border-color);
    transition: transform 0.4s ease-in-out;
    background-color: var(--bg-primary);
  }

  nav::-webkit-scrollbar {
    width: 8px;
  }

  nav::-webkit-scrollbar-track {
    background: transparent;
  }

  nav::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    border: 2px solid transparent;
  }

  @media (max-width: 1300px) {
    .nav-toggle {
      display: none;
    }

    nav {
      position: fixed;
      transform: translateX(-100%);
      width: 85%;
      max-width: 300px;
      height: calc(100vh - 57px);
      top: 57px;
    }

    nav.active {
      transform: translateX(0);
    }
  }
</style>


    <div class="content">
        <div class="header">
  <div class="header-content">
    <button
      id="mobile-nav-toggle"
      aria-label="Toggle navigation"
      class="mobile-only"
    >
      <i class="bx bx-menu"></i>
    </button>
    <script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.querySelector(".search-input");
    const overlay = document.querySelector(".overlay");
    const searchResults = document.querySelector(".search-results");

    function closeSearch() {
      overlay.style.display = "none";
      searchResults.style.display = "none";
      searchInput.blur();
    }

    function openSearch() {
      overlay.style.display = "block";
      searchResults.style.display = "block";
    }

    searchInput.addEventListener("focus", openSearch);
    overlay.addEventListener("click", closeSearch);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeSearch();
      }
    });
  });
</script>
<div class="overlay"></div>
<input class="search-input" type="text" placeholder="Search..." />
<div class="search-results">
  <div class="search-results__header">
    <span class="search-results__count">Waiting for input...</span>
  </div>
  <div class="search-results__items"></div>
</div>

<style>
  .search-input {
    width: 100%;
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background-color: var(--bg-interactive);
    color: var(--text-primary);
    font-size: 0.875rem;
    transition: all 0.2s ease;
    z-index: 101;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--spike-blue);
    background-color: var(--bg-primary);
    box-shadow: 0 0 0 2px rgba(var(--spike-blue-rgb), 0.2);
  }

  .search-input::placeholder {
    color: var(--text-muted);
  }

  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 100;
  }

  .search-results {
    display: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    max-width: 700px;
    margin: 0.5rem auto;
    background: var(--bg-primary);
    border-radius: 8px;
    box-shadow: 0px 4px 8px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border-color);
    z-index: 102;
  }

  .search-results__header {
    padding: 0.75rem 1rem;
    color: var(--text-muted);
    font-size: 0.875rem;
    border-bottom: 1px solid var(--border-color);
  }

  .search-results__items {
    max-height: 60vh;
    overflow-y: auto;
  }

  .search-results__item {
    display: block;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s ease;
  }

  .search-results__item:hover {
    background-color: var(--bg-interactive);
  }

  .search-results__title {
    color: var(--spike-blue);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
  }

  .search-results__preview {
    color: var(--text-secondary);
    font-size: 0.8125rem;
    line-height: 1.4;
  }

  .search-results__preview b {
    color: var(--spike-dark-green);
    font-weight: 600;
  }

  .search-results__items::-webkit-scrollbar {
    width: 4px;
  }

  .search-results__items::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
  }

  /* Empty state */
  .search-results__empty {
    padding: 2rem 1rem;
    text-align: center;
    color: var(--text-muted);
    font-size: 0.875rem;
  }
</style>

    <a
      href="https://github.com/spiffe/spike"
      target="_blank"
      rel="noopener"
      class="github-star"
    >
      <i class="bx bx-star"></i>
      <span>Star <strong>SPIKE</strong> on <strong>GitHub</strong></span>
    </a>
    <button id="theme-toggle" aria-label="Toggle theme">
      <i class="bx bx-sun light-icon"></i>
      <i class="bx bx-moon dark-icon"></i>
    </button>
  </div>
</div>

<style>
  .header {
    position: sticky;
    top: 0;
    background-color: var(--bg-primary);
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    box-shadow: 0 4px 6px -1px var(--shadow-color),
      0 2px 4px -1px var(--shadow-color);
    z-index: 101;
  }

  .header-content {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #mobile-nav-toggle {
    display: none;
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 1.5rem;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  #mobile-nav-toggle i {
    pointer-events: none;
    display: block;
  }

  #mobile-nav-toggle:hover {
    background-color: var(--bg-interactive);
  }

  @media (max-width: 1300px) {
    #mobile-nav-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
  }

  #theme-toggle {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 1.25rem;
    border-radius: 4px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #theme-toggle:hover {
    background-color: var(--bg-interactive);
  }

  #theme-toggle:active {
    background-color: var(--bg-secondary);
  }

  /* Show/hide icons based on theme */
  [data-theme="dark"] .light-icon,
  :root:not([data-theme="dark"]) .dark-icon {
    display: none;
  }

  /* GitHub Star Button */
  .github-star {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    color: white;
    text-decoration: none;
    background: linear-gradient(
      135deg,
      var(--spike-blue),
      var(--spike-dark-green)
    );
    border-radius: 20px;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    white-space: nowrap;
  }

  .github-star:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(var(--spike-blue-rgb), 0.3);
  }

  .github-star i {
    font-size: 1.1rem;
    animation: starBounce 2s infinite;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  @keyframes starBounce {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.2);
    }
  }

  .github-star span {
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .github-star span {
      display: none;
    }

    .github-star {
      padding: 0.5rem;
    }
  }
</style>

<script>
  // Theme toggle functionality
  document.addEventListener("DOMContentLoaded", () => {
    const themeToggle = document.getElementById("theme-toggle");

    // Function to set theme
    function setTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
    }

    // Initialize theme
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
      setTheme(savedTheme);
    } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      setTheme("dark");
    }

    // Toggle theme on button click
    themeToggle.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      setTheme(newTheme);
    });

    // Listen for system theme changes
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        if (!localStorage.getItem("theme")) {
          setTheme(e.matches ? "dark" : "light");
        }
      });
  });
</script>


        <article>
            
        <h1 id="spike-backup-and-restore-guide">SPIKE Backup and Restore Guide</h1>
<p><strong>SPIKE</strong>, the Secure Production Identity Framework for Key Encryption, provides
robust secrets management with strong identity controls. But even the most
reliable systems need comprehensive backup and recovery plans. This guide
explains how to properly back up, secure, and restore SPIKE deployments—ensuring
your critical secrets infrastructure remains resilient against catastrophic
failures.</p>
<h2 id="architecture-foundations-for-effective-backup-planning">Architecture Foundations for Effective Backup Planning</h2>
<p>SPIKE consists of three critical components, each requiring specific backup
considerations:</p>
<ol>
<li>
<p><strong>SPIKE Nexus</strong>: The central component handling secret encryption/decryption
and root key management. It stores encrypted secrets in a SQLite database
and communicates via an mTLS API.</p>
</li>
<li>
<p><strong>SPIKE Keeper</strong>: A redundancy mechanism holding Shamir Secret Sharing shards
of the root key in memory. Multiple Keeper instances provide resiliency,
requiring a configurable threshold of shards to reconstruct the root key.</p>
</li>
<li>
<p><strong>SPIKE Pilot</strong>: The CLI interface that translates administrative commands
into mTLS API calls to <strong>SPIKE Nexus</strong>.</p>
</li>
</ol>
<p>The foundation of SPIKE’s security model lies in its root key management:</p>
<ul>
<li>The <strong>root key</strong> encrypts all data in the backing store and <strong>never</strong> exists
on disk in plaintext</li>
<li>The system splits the root key into multiple Shamir shards based on a
configurable threshold (<em>e.g., any 2 of 3 or 3 of 5 shards needed to
reconstruct</em>)</li>
<li><strong>SPIKE Keeper</strong>s hold these shards in memory for automatic recovery if
<strong>SPIKE Nexus</strong> crashes</li>
<li>For disaster recovery scenarios, administrators can create additional recovery
shards</li>
</ul>
<h2 id="backup-procedures">Backup procedures</h2>
<h3 id="sqlite-database-backup">SQLite database backup</h3>
<p>The SPIKE Nexus uses a SQLite database to store all encrypted secrets and
metadata. This database is typically located in <code>~/.spike</code> on the Nexus server.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 1. First, ensure consistent state by using SQLite&#39;s online backup API
</span><span style="color:#bf616a;">sqlite3 ~</span><span>/.spike/database.sqlite \
</span><span>  &quot;</span><span style="color:#a3be8c;">.backup &#39;/backup/spike_nexus_db_</span><span>$</span><span style="color:#a3be8c;">(</span><span style="color:#bf616a;">date</span><span style="color:#a3be8c;"> +</span><span>%</span><span style="color:#bf616a;">Y</span><span>%</span><span style="color:#bf616a;">m</span><span>%</span><span style="color:#bf616a;">d_</span><span>%</span><span style="color:#bf616a;">H</span><span>%</span><span style="color:#bf616a;">M</span><span>%</span><span style="color:#bf616a;">S</span><span style="color:#a3be8c;">).sqlite&#39;</span><span>&quot;
</span><span>
</span><span style="color:#65737e;"># 2. For WAL mode databases, checkpoint first to ensure consistency
</span><span style="color:#bf616a;">sqlite3 ~</span><span>/.spike/database.sqlite &quot;</span><span style="color:#a3be8c;">PRAGMA wal_checkpoint(FULL);</span><span>&quot;
</span><span style="color:#bf616a;">sqlite3 ~</span><span>/.spike/database.sqlite \
</span><span>  &quot;</span><span style="color:#a3be8c;">.backup &#39;/backup/spike_nexus_db_</span><span>$</span><span style="color:#a3be8c;">(</span><span style="color:#bf616a;">date</span><span style="color:#a3be8c;"> +</span><span>%</span><span style="color:#bf616a;">Y</span><span>%</span><span style="color:#bf616a;">m</span><span>%</span><span style="color:#bf616a;">d_</span><span>%</span><span style="color:#bf616a;">H</span><span>%</span><span style="color:#bf616a;">M</span><span>%</span><span style="color:#bf616a;">S</span><span style="color:#a3be8c;">).sqlite&#39;</span><span>&quot;
</span><span>
</span><span style="color:#65737e;"># 3. Verify backup integrity
</span><span style="color:#bf616a;">sqlite3</span><span> /backup/spike_nexus_db_*.sqlite &quot;</span><span style="color:#a3be8c;">PRAGMA integrity_check;</span><span>&quot;
</span></code></pre>
<p><strong>Important considerations:</strong></p>
<ul>
<li>The SQLite database backup contains encrypted data that can only be decrypted
with the root key</li>
<li>Use database-level locking through SQLite’s <code>.backup</code> command rather than
direct file copying</li>
</ul>
<h3 id="root-key-and-cryptographic-material-backup">Root key and cryptographic material backup</h3>
<p>The root key is <strong>SPIKE</strong>’s most critical component. While it exists only in
memory during normal operation, you must back it up for disaster recovery using
Shamir’s Secret Sharing:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Create recovery shards of the root key
</span><span style="color:#65737e;"># IMPORTANT: Run this BEFORE any disaster occurs
</span><span style="color:#bf616a;">spike</span><span> recover
</span><span>
</span><span style="color:#65737e;"># This will generate multiple shard files under `~/.spike/recovery` folder. 
</span></code></pre>
<p><strong>Secure handling of recovery shards:</strong></p>
<ol>
<li>Encrypt each shard immediately after creation (<em>e.g., using GPG with
hardware keys</em>)</li>
<li>Store encrypted shards in separate secure locations</li>
<li>Consider using HSMs or smart cards for shard storage</li>
<li>Implement strict access controls for shard access</li>
<li>Document the threshold configuration (<em>e.g., “2 of 3 shards required”</em>)</li>
</ol>
<h3 id="configuration-and-other-components-backup">Configuration and other components backup</h3>
<p>Beyond the database and root key, back up these critical components:</p>
<ol>
<li>
<p><strong>SPIRE Server</strong> and <strong>SPIRE Agent</strong> configuration.</p>
</li>
<li>
<p>SPIFFE registration entries:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Back up SPIFFE registration entries
</span><span style="color:#bf616a;">spire-server</span><span> entry show &gt; /backup/spire_entries_$(</span><span style="color:#bf616a;">date</span><span> +%</span><span style="color:#bf616a;">Y</span><span>%</span><span style="color:#bf616a;">m</span><span>%</span><span style="color:#bf616a;">d</span><span>).txt
</span></code></pre>
</li>
</ol>
<h2 id="restore-procedures">Restore procedures</h2>
<h3 id="prerequisites-for-restoration">Prerequisites for Restoration</h3>
<p>Before beginning any restore operation, ensure:</p>
<ol>
<li>
<p>You have all necessary components:</p>
<ul>
<li>SQLite database backup</li>
<li>Access to the required number of recovery shards (<em>meeting your threshold</em>)</li>
<li>SPIFFE/SPIRE configuration backups</li>
</ul>
</li>
<li>
<p>You have the appropriate SPIFFE identity for restoration:</p>
<ul>
<li>Required SPIFFE ID: <code>spiffe://$trustRoot/spike/pilot/role/restore</code></li>
</ul>
</li>
<li>
<p>All <strong>SPIKE</strong> services are properly installed on the target system</p>
</li>
</ol>
<h3 id="root-key-restoration">Root key restoration</h3>
<p>If both <strong>SPIKE Nexus</strong> and all <strong>SPIKE Keeper</strong>s are unavailable
(<em>catastrophic failure</em>), follow this procedure:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># 1. Configure SPIKE Pilot for restore operations 
</span><span style="color:#65737e;"># (adjust the script path for your environment)
</span><span style="color:#bf616a;">./hack/bare-metal/entry/spire-server-entry-restore-register.sh
</span><span>
</span><span style="color:#65737e;"># 2. Run the restore command
</span><span style="color:#bf616a;">spike</span><span> restore
</span><span>
</span><span style="color:#65737e;"># 3. When prompted, provide recovery shards one at a time
</span><span style="color:#65737e;"># You&#39;ll need to provide enough shards to meet your threshold (e.g., 2 of 3)
</span><span>
</span><span style="color:#65737e;"># 4. After successful restoration, revert SPIKE Pilot to normal operation
</span><span style="color:#bf616a;">./hack/bare-metal/entry/spire-server-entry-su-register.sh
</span></code></pre>
<p>SPIKE Nexus will:</p>
<ul>
<li>Automatically reconstruct the root key from the provided shards</li>
<li>Redistribute shards to available SPIKE Keeper instances</li>
<li>Resume normal operation with the restored key</li>
</ul>
<h3 id="sqlite-database-restoration">SQLite database restoration</h3>
<p>To restore the SQLite database:</p>
<ol>
<li>
<p>Stop <strong>SPIKE Nexus</strong>.</p>
</li>
<li>
<p>Replace the current database with the backup.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">cp</span><span> /backup/spike_nexus_db_TIMESTAMP.sqlite \
</span><span>  </span><span style="color:#bf616a;">~</span><span>/.spike/database.sqlite
</span><span>
</span></code></pre>
</li>
<li>
<p>Set appropriate permissions</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">chown</span><span> spike:spike </span><span style="color:#bf616a;">~</span><span>/.spike/database.sqlite
</span><span style="color:#bf616a;">chmod</span><span> 600 </span><span style="color:#bf616a;">~</span><span>/.spike/database.sqlite
</span></code></pre>
</li>
<li>
<p>Start <strong>SPIKE Nexus</strong></p>
</li>
</ol>
<p><strong>Note</strong>: After restoring the database, if <strong>SPIKE Nexus</strong> cannot automatically
recover the root key from <strong>SPIKE Keeper</strong>s, you’ll need to perform the root
key restoration procedure above.</p>
<h3 id="verification-procedures">Verification procedures</h3>
<p>After completing a restore operation, verify system integrity:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Verify database integrity
</span><span style="color:#bf616a;">sqlite3 ~</span><span>/.spike/database.sqlite &quot;</span><span style="color:#a3be8c;">PRAGMA integrity_check;</span><span>&quot;
</span><span>
</span><span style="color:#65737e;"># Test secret access to verify encryption/decryption is working
</span><span style="color:#bf616a;">spike</span><span> get /path/to/test/secret
</span></code></pre>
<h2 id="backup-best-practices">Backup best practices</h2>
<h3 id="backup-frequency-and-scheduling">Backup frequency and scheduling</h3>
<table><thead><tr><th>Component</th><th>Recommended Frequency</th><th>Reasoning</th></tr></thead><tbody>
<tr><td>SQLite Database</td><td>Daily</td><td>Captures secret changes promptly</td></tr>
<tr><td>Root Key Shards</td><td>After initial setup and after any root key rotation</td><td>Critical security component</td></tr>
<tr><td>Configuration</td><td>After any configuration change</td><td>Ensures you can recreate the environment</td></tr>
<tr><td>SPIFFE Entries</td><td>After any identity changes</td><td>Required for workload authentication</td></tr>
</tbody></table>
<h3 id="backup-rotation-and-retention">Backup rotation and retention</h3>
<p>Implement a comprehensive retention policy:</p>
<ul>
<li><strong>Short-term backups</strong>: Keep daily backups for 14 days</li>
<li><strong>Medium-term backups</strong>: Keep weekly backups for 3 months</li>
<li><strong>Long-term backups</strong>: Keep monthly backups for 1 year</li>
</ul>
<blockquote>
<p><strong>Test Your Backup Integrity</strong></p>
<p>A backup that does not work when you need most is not a backup.
Make sure you validate the integrity and efficacy of your backups
regularly.</p>
</blockquote>
<h3 id="secure-storage-recommendations">Secure Storage Recommendations</h3>
<p>For root key recovery shards:</p>
<ul>
<li><strong>Multi-level security</strong>: Encrypt shards before storage</li>
<li><strong>Physical separation</strong>: Store shards in different physical locations</li>
<li><strong>Access controls</strong>: Implement strict controls with separation of duties</li>
<li><strong>Hardware security</strong>: Consider HSMs or smart cards for shard storage</li>
<li><strong>Environmental protection</strong>: Use fire/water-resistant safes for physical media</li>
</ul>
<p>For database backups:</p>
<ul>
<li><strong>Encryption</strong>: Implement at-rest encryption for all backup files</li>
<li><strong>Access limitations</strong>: Restrict backup access to authorized personnel only</li>
<li><strong>Immutability</strong>: Consider WORM (Write Once Read Many) storage for critical backups</li>
<li><strong>Offline copies</strong>: Maintain air-gapped copies of critical backups</li>
</ul>
<h2 id="migration-limitations-and-planning">Migration Limitations and Planning</h2>
<p>While <strong>SPIKE</strong> currently lacks built-in migration tools, careful planning can
facilitate future migrations.</p>
<h3 id="current-migration-limitations">Current migration limitations</h3>
<ul>
<li>No direct database migration between different SPIKE versions</li>
<li>Manual coordination is required for root key transfers</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>A comprehensive backup and restore strategy is essential for maintaining the
resilience of your <strong>SPIKE</strong> deployment. By following the procedures in this
guide, you can ensure that even in catastrophic failure scenarios, your secrets
management infrastructure can be rapidly restored with minimal data loss.</p>
<p>Remember these key principles:</p>
<ul>
<li><strong>Regular backups</strong>: Automated, validated, and securely stored</li>
<li><strong>Root key protection</strong>: The foundation of your security model</li>
<li><strong>Tested procedures</strong>: Verify your restore process works before you need it</li>
<li><strong>Documentation</strong>: Keep clear records of all configurations and procedures</li>
</ul>
<p>By implementing these practices, your DevOps team will be prepared to handle
any recovery scenario while maintaining the security guarantees that make
<strong>SPIKE</strong> an effective secrets management solution.</p>

    
        </article>

        <footer id="footer">
            Copyright © 2024-present <strong>SPIKE Contributors</strong>.<br>
            <strong>SPIKE</strong>'s code
            is distributed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache (v2.0)</a>.
            <br>
            The documentation on this website
            is distributed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a>.
            <br><br>
            We <strong>do not</strong> collect your data.
            This site <strong>does not</strong> use any tracking cookies or scripts.
        </footer>
    </div>

</main>


    <script type="text/javascript" src="https://spike.ist/elasticlunr.min.js" defer></script>
    <script type="text/javascript" src="https://spike.ist/search_index.en.js" defer></script>
<script type="text/javascript" src="https://spike.ist/js.js" defer></script>
</body>
</html>
<style>
body {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;
    font-family: var(--font-family);
    background-color: var(--bg-primary);
    color: var(--text-primary);
}

main {
    width: 100vw;
    max-width: 1920px;
    display: flex;
    flex-direction: row;
    overflow: hidden;
}

#footer {
    text-align: center;
    padding: 2rem;
    font-size: 0.875rem;
    color: var(--text-muted);
    border-top: 1px solid var(--border-color);
    margin-top: 2rem;
}

.content {
    display: flex;
    flex-direction: column;
    flex: 1;
    height: 100vh;
    overflow-y: auto;
    background-color: var(--bg-primary);
    line-height: 1.6;
    border-left: 1px solid var(--border-color);
}

#footer a {
    color: var(--spike-blue);
    text-decoration: none;
    transition: all 0.2s ease;
    border-bottom: 1px solid transparent;
    font-weight: 500;

}

#footer a:hover {
    border-bottom-color: var(--spike-blue);
}

</style>