<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/main.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" href="https://spike.ist/assets/spike-favicon-16x16.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> SPIKE | SPIKE on Kubernetes </title>
</head>
<body>

<main>
    
    <nav>
  <script>
    fetch('https://api.github.com/repos/spiffe/spike/releases/latest')
        .then(response => response.json())
        .then(data => {
            const release = document.getElementById('release');
            const icon = '<i class="bx bx-package"></i>';
            release.href = data.name ? data.html_url : 'https://api.github.com/repos/spiffe/spike/releases';
            release.innerHTML = icon + (data.name ? ' ' + data.name : ' Releases');
        });
</script>
<div id="banner">
    <a href="https://spike.ist">
        <img id="banner-image" src="https://spike.ist/assets/spike-banner.png" alt="logo" />
    </a>
    <div id="banner-body">
        <a class="banner-title" href="https://spike.ist">
            SPIKE
        </a>
        <span class="banner-tagline">
            Secure your secrets<br> with SPIFFE.
        </span>
        <a id="release" class="banner-link" href="https://github.com/spiffe/spike/releases">
            <i class='bx bx-package'></i>
        </a>
        <a href="https://github.com/spiffe/spike" class="banner-link">
            <i class='bx bxl-github'></i> GitHub
        </a>

    </div>
</div>
<style>
   /* Banner on top of the nav */
   #banner {
        position: sticky;
        background-color: var(--bg-primary);
        z-index: 100;
        top: 0;
        display: flex;
        flex-direction: row;
        padding: 1rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
    }

    #banner img {
        width: 100px;
        height: auto;
    }

    #banner-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        margin-left: 1rem;
    }

    .banner-title {
        font-size: 1.75rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        margin-bottom: -15px;
        font-family: var(--brand-font-family);
    }
    .banner-tagline {
        font-size: 0.875rem;
        color: var(--text-muted);
        font-style: italic;
    }

    .banner-link {
        display: flex;
        gap: 0.5rem;
        min-width: 84px;
        font-size: 0.875rem;
        font-weight: 300;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        background-color: var(--bg-interactive);
        transition: all 0.2s ease;
    }

    .banner-link i {
        font-size: 1.125rem;
        color: var(--spike-blue);
    }

    .banner-link:hover {
        background-color: var(--spike-blue);
    }
</style> <div id="trees">
    <input class="tree-toggle" type="checkbox" id="about"
               />
        <label class="tree-toggle-label "
               for="about">About</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/about/intro/">About SPIKE</a>
                </li>

                <li >
                    <a href="https://spike.ist/about/project-status/">Project Maturity</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="community"
               />
        <label class="tree-toggle-label "
               for="community">Community</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/community/hello/">Hello Universe</a>
                </li>

                <li >
                    <a href="https://spike.ist/community/contact/">Contact Us</a>
                </li>

                <li >
                    <a href="https://spike.ist/community/presentations/">Presentations and Demos</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="getting-started"
               />
        <label class="tree-toggle-label "
               for="getting-started">Getting Started</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/getting-started/quickstart/">SPIKE Quickstart Guide</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="using-spike"
               />
        <label class="tree-toggle-label "
               for="using-spike">Using SPIKE</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/usage/configuration/">Configuring SPIKE</a>
                </li>

                <li >
                    <a href="https://spike.ist/usage/cli/">SPIKE CLI</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="developing-spike"
               checked/>
        <label class="tree-toggle-label "
               for="developing-spike">Developing SPIKE</label>

        <ul class="subtree">
            <li class="active">
                    <a href="https://spike.ist/development/local-deployment/">SPIKE on Kubernetes</a>
                </li>

                
                        
                        
                            <ul id="toc">
                                <li><a href="
                                            https://spike.ist/development/local-deployment/#building-spike-locally-and-deploying-to-minikube">Building SPIKE Locally and Deploying to Minikube</a>
                                        <ul>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#prerequisites">Prerequisites</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#starting-minikube">Starting Minikube</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#forwarding-the-local-registry">Forwarding the Local Registry</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#build-container-images-locally">Build Container Images Locally</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#pushing-container-images-to-the-local-registry">Pushing Container Images to the Local Registry</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#docker-windows-subsystem-for-linux-integration-issues">Docker Windows Subsystem for Linux Integration Issues</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#deploying-spire-and-spike-to-the-local-cluster">Deploying SPIRE and SPIKE to the Local Cluster</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#verifying-spike-deployment">Verifying SPIKE Deployment</a>
                                                    </li>
                                                <li>
                                                        <a href="https://spike.ist/development/local-deployment/#you-are-all-set">You Are All Set</a>
                                                    </li>
                                                </ul>
                                        </li>
                                </ul>
                        <li >
                    <a href="https://spike.ist/development/bare-metal/">SPIKE on Linux</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="spike-architecture"
               />
        <label class="tree-toggle-label "
               for="spike-architecture">SPIKE Architecture</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/architecture/system-overview/">System Overview</a>
                </li>

                <li >
                    <a href="https://spike.ist/architecture/security-model/">SPIKE Security Model</a>
                </li>

                <li >
                    <a href="https://spike.ist/architecture/architectural-decision-records/">ADRs</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="tracking"
               />
        <label class="tree-toggle-label "
               for="tracking">Tracking</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/tracking/changelog/">Changelog</a>
                </li>

                <li >
                    <a href="https://spike.ist/tracking/snapshots/">Documentation Snapshots</a>
                </li>

                </ul>
    <input class="tree-toggle" type="checkbox" id="operations"
               />
        <label class="tree-toggle-label "
               for="operations">Operations</label>

        <ul class="subtree">
            <li >
                    <a href="https://spike.ist/operations/build/">SPIKE Cross-Platform Build</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/production/">SPIKE Production Setup</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/recovery/">SPIKE Recovery Procedures</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/backup/">SPIKE Backup and Restore</a>
                </li>

                <li >
                    <a href="https://spike.ist/operations/release/">SPIKE Relase Management</a>
                </li>

                </ul>
    </div>
<style>
    /* Navigation tree structure */
    #trees {
        padding: 0 1rem;
    }

    .tree-toggle {
        display: none;
    }

    .tree-toggle:checked + .tree-toggle-label + .subtree {
        display: block;
    }

    .tree-toggle-label {
        display: block;
        padding: 0.75rem 1rem;
        margin: 0.25rem 0;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .tree-toggle-label:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .tree-toggle-label::before {
        content: '▸';
        display: inline-block;
        margin-right: 0.5rem;
        transition: transform 0.2s ease;
    }

    .tree-toggle:checked + .tree-toggle-label::before {
        transform: rotate(90deg);
    }

    .subtree {
        display: none;
        margin: 0;
        padding: 0 0 0 1rem;
        list-style: none;
    }

    .subtree li {
        margin: 0.25rem 0;
    }

    .subtree li a {
        display: block;
        padding: 0.5rem 1rem;
        text-decoration: none;
        border-radius: 4px;
        font-size: 0.9375rem;
        transition: all 0.2s ease;
    }

    .subtree li a:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }

    .subtree li.active a {
        font-weight: 600;
        background-color: rgba(0, 0, 0, 0.05);
    }

    /* Table of contents styling */
    #toc {
        margin: 0.5rem 0 0.5rem 1.5rem;
        padding: 0;
        list-style: none;
        font-size: 0.875rem;
    }

    #toc li {
        margin: 0.25rem 0;
    }

    #toc li a {
        padding: 0.375rem 0.75rem;
        opacity: 0.8;
    }

    #toc li a:hover {
        opacity: 1;
    }

    #toc ul {
        margin: 0.25rem 0 0.25rem 1rem;
        padding: 0;
        list-style: none;
    }
</style>
</nav>
<style>
  nav {
    position: sticky;
    width: 300px;
    height: 100vh;
    top: 0;
    max-height: 100vh;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
    z-index: 100;
    box-shadow: 5px 0 20px var(--shadow-color);
    border-right: 1px solid var(--border-color);
    transition: transform 0.4s ease-in-out;
    background-color: var(--bg-primary);
  }

  nav::-webkit-scrollbar {
    width: 8px;
  }

  nav::-webkit-scrollbar-track {
    background: transparent;
  }

  nav::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    border: 2px solid transparent;
  }

  @media (max-width: 1300px) {
    .nav-toggle {
      display: none;
    }

    nav {
      position: fixed;
      transform: translateX(-100%);
      width: 85%;
      max-width: 300px;
      height: calc(100vh - 57px);
      top: 57px;
    }

    nav.active {
      transform: translateX(0);
    }
  }
</style>


    <div class="content">
        <div class="header">
  <div class="header-content">
    <button
      id="mobile-nav-toggle"
      aria-label="Toggle navigation"
      class="mobile-only"
    >
      <i class="bx bx-menu"></i>
    </button>
    <script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.querySelector(".search-input");
    const overlay = document.querySelector(".overlay");
    const searchResults = document.querySelector(".search-results");

    function closeSearch() {
      overlay.style.display = "none";
      searchResults.style.display = "none";
      searchInput.blur();
    }

    function openSearch() {
      overlay.style.display = "block";
      searchResults.style.display = "block";
    }

    searchInput.addEventListener("focus", openSearch);
    overlay.addEventListener("click", closeSearch);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeSearch();
      }
    });
  });
</script>
<div class="overlay"></div>
<input class="search-input" type="text" placeholder="Search..." />
<div class="search-results">
  <div class="search-results__header">
    <span class="search-results__count">Waiting for input...</span>
  </div>
  <div class="search-results__items"></div>
</div>

<style>
  .search-input {
    width: 100%;
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background-color: var(--bg-interactive);
    color: var(--text-primary);
    font-size: 0.875rem;
    transition: all 0.2s ease;
    z-index: 101;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--spike-blue);
    background-color: var(--bg-primary);
    box-shadow: 0 0 0 2px rgba(var(--spike-blue-rgb), 0.2);
  }

  .search-input::placeholder {
    color: var(--text-muted);
  }

  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 100;
  }

  .search-results {
    display: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    max-width: 700px;
    margin: 0.5rem auto;
    background: var(--bg-primary);
    border-radius: 8px;
    box-shadow: 0px 4px 8px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border-color);
    z-index: 102;
  }

  .search-results__header {
    padding: 0.75rem 1rem;
    color: var(--text-muted);
    font-size: 0.875rem;
    border-bottom: 1px solid var(--border-color);
  }

  .search-results__items {
    max-height: 60vh;
    overflow-y: auto;
  }

  .search-results__item {
    display: block;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
    transition: background-color 0.2s ease;
  }

  .search-results__item:hover {
    background-color: var(--bg-interactive);
  }

  .search-results__title {
    color: var(--spike-blue);
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.25rem;
  }

  .search-results__preview {
    color: var(--text-secondary);
    font-size: 0.8125rem;
    line-height: 1.4;
  }

  .search-results__preview b {
    color: var(--spike-dark-green);
    font-weight: 600;
  }

  .search-results__items::-webkit-scrollbar {
    width: 4px;
  }

  .search-results__items::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: 4px;
  }

  /* Empty state */
  .search-results__empty {
    padding: 2rem 1rem;
    text-align: center;
    color: var(--text-muted);
    font-size: 0.875rem;
  }
</style>

    <a
      href="https://github.com/spiffe/spike"
      target="_blank"
      rel="noopener"
      class="github-star"
    >
      <i class="bx bx-star"></i>
      <span>Star <strong>SPIKE</strong> on <strong>GitHub</strong></span>
    </a>
    <button id="theme-toggle" aria-label="Toggle theme">
      <i class="bx bx-sun light-icon"></i>
      <i class="bx bx-moon dark-icon"></i>
    </button>
  </div>
</div>

<style>
  .header {
    position: sticky;
    top: 0;
    background-color: var(--bg-primary);
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    box-shadow: 0 4px 6px -1px var(--shadow-color),
      0 2px 4px -1px var(--shadow-color);
    z-index: 101;
  }

  .header-content {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #mobile-nav-toggle {
    display: none;
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 1.5rem;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  #mobile-nav-toggle i {
    pointer-events: none;
    display: block;
  }

  #mobile-nav-toggle:hover {
    background-color: var(--bg-interactive);
  }

  @media (max-width: 1300px) {
    #mobile-nav-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
  }

  #theme-toggle {
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--text-primary);
    font-size: 1.25rem;
    border-radius: 4px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #theme-toggle:hover {
    background-color: var(--bg-interactive);
  }

  #theme-toggle:active {
    background-color: var(--bg-secondary);
  }

  /* Show/hide icons based on theme */
  [data-theme="dark"] .light-icon,
  :root:not([data-theme="dark"]) .dark-icon {
    display: none;
  }

  /* GitHub Star Button */
  .github-star {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    color: white;
    text-decoration: none;
    background: linear-gradient(
      135deg,
      var(--spike-blue),
      var(--spike-dark-green)
    );
    border-radius: 20px;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    white-space: nowrap;
  }

  .github-star:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(var(--spike-blue-rgb), 0.3);
  }

  .github-star i {
    font-size: 1.1rem;
    animation: starBounce 2s infinite;
    color: #ffd700;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  @keyframes starBounce {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.2);
    }
  }

  .github-star span {
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .github-star span {
      display: none;
    }

    .github-star {
      padding: 0.5rem;
    }
  }
</style>

<script>
  // Theme toggle functionality
  document.addEventListener("DOMContentLoaded", () => {
    const themeToggle = document.getElementById("theme-toggle");

    // Function to set theme
    function setTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
      
      // Update banner image based on theme
      const bannerImage = document.getElementById("banner-image");
      if (bannerImage) {
        bannerImage.src = theme === "dark" 
          ? "/assets/spike-banner-dark-thin.png"
          : "/assets/spike-banner-light-thin.png";
      }
    }

    // Initialize theme
    const savedTheme = localStorage.getItem("theme");
    setTheme(savedTheme ? savedTheme : "dark");
    // Discard system theme changes; the landing page is always dark, so
    // it's better to transition to a dark-by-default theme.
    // } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
    //   setTheme("dark");
    // }

    // Toggle theme on button click
    themeToggle.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      setTheme(newTheme);
    });

    // Discard system-theme changes.
    // window
    //   .matchMedia("(prefers-color-scheme: dark)")
    //   .addEventListener("change", (e) => {
    //     if (!localStorage.getItem("theme")) {
    //       setTheme(e.matches ? "dark" : "light");
    //     }
    //   });
  });
</script>


        <article>
            
        <h1 id="building-spike-locally-and-deploying-to-minikube">Building SPIKE Locally and Deploying to Minikube</h1>
<p>If you want to contribute to the <strong>SPIKE</strong> codebase and test your changes on a
local Kubernetes cluster, follow this guide. If you want to build SPIKE from
the source code but want to test it on a <em>bare metal</em> Linux machine without
using any containerization solution, check out
<a href="https://spike.ist/development/bare-metal/" title="SPIKE on Linux"><strong>SPIKE</strong> on Linux</a> instead.</p>
<p>In this guide we will follow a similar approach to
<a href="https://spike.ist/getting-started/quickstart/" title="Getting Started with SPIKE"><strong>SPIKE</strong> Quickstart</a>, with the following changes:</p>
<ol>
<li>Build container images locally from existing source code.</li>
<li>Push the container images to a local container registry.</li>
<li>Use a customized <code>values-dev.yaml</code> for the helm charts to create a more
production-like namespace structure.</li>
</ol>
<p>Without further ado, let’s begin with the prerequisites.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Here is a list of things you need to have installed on your machine before
starting with this guide:</p>
<ul>
<li>Have <a href="https://www.docker.com/" title="Docker: Build, Share, and Run Applications">Docker</a> installed and running on your machine.</li>
<li>Have a <a href="https://kubernetes.io/docs/tasks/tools/" title="kubectl: Kubernetes command-line tool"><code>kubectl</code></a> client installed.</li>
<li>Have <a href="https://www.gnu.org/software/make/" title="GNU Make: Build Automation Tool"><code>make</code></a> installed on your machine.</li>
<li>Have a [<code>minikube</code>][minikube] binary installed.</li>
<li>Have <a href="https://helm.sh/" title="Helm"><code>helm</code></a> binary installed.</li>
</ul>
<h2 id="starting-minikube">Starting Minikube</h2>
<p>To start a local Minikube cluster, clone the project repository and run the
following command in the root directory of the project:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">cd </span><span>$</span><span style="color:#bf616a;">WORKSPACE </span><span style="color:#65737e;"># Replace with your workspace directory
</span><span style="color:#bf616a;">git</span><span> clone https://github.com/spiffe/spike.git
</span><span style="color:#96b5b4;">cd</span><span> spike
</span><span style="color:#bf616a;">make</span><span> docker-cleanup </span><span style="color:#65737e;"># (Optional) Purge docker registry.
</span><span style="color:#bf616a;">make</span><span> k8s-delete     </span><span style="color:#65737e;"># Delete any former Minikube installation.
</span><span style="color:#bf616a;">make</span><span> k8s-start      </span><span style="color:#65737e;"># This will start a Minikube cluster.
</span></code></pre>
<p>If successful, you will have a local Minikube cluster running with the
necessary plugins enabled. You can verify that Minikube is running by executing:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">minikube</span><span> status
</span><span style="color:#65737e;"># or...
</span><span style="color:#bf616a;">kubectl</span><span> get node
</span><span>
</span><span style="color:#65737e;"># Sample Outputs:
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># $ minikube status
</span><span style="color:#65737e;"># minikube
</span><span style="color:#65737e;"># type: Control Plane
</span><span style="color:#65737e;"># host: Running
</span><span style="color:#65737e;"># kubelet: Running
</span><span style="color:#65737e;"># apiserver: Running
</span><span style="color:#65737e;"># kubeconfig: Configured
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># $ kubectl get node
</span><span style="color:#65737e;"># NAME       STATUS   ROLES           AGE   VERSION
</span><span style="color:#65737e;"># minikube   Ready    control-plane   67s   v1.33.1
</span></code></pre>
<h2 id="forwarding-the-local-registry">Forwarding the Local Registry</h2>
<p>Since Minikube contains its Kubernetes cluster in a virtual machine, accessing
its container registry requires network mapping. There are several ways to
achieve this. In this guide, we will use Kubernetes port forwarding.</p>
<p>Open a terminal, change your directory to the project’s folder, and execute
the following:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">make</span><span> docker-forward-registry
</span><span style="color:#65737e;"># Sample Output:
</span><span style="color:#65737e;"># Forwarding from 127.0.0.1:5000 -&gt; 5000
</span><span style="color:#65737e;"># Forwarding from [::1]:5000 -&gt; 5000
</span></code></pre>
<p>Leave this terminal open. We will execute the rest of the commands in<br />
a separate terminal window.</p>
<blockquote>
<p><strong>Alternative to Registry Port Forwarding</strong></p>
<p>If you don’t want to use port forwarding, you can directly load the container
images into the Minikube cluster’s local registry.</p>
<p>Although this is typically used to overcome network restrictions around
WSL and Docker for Windows, it can also be used as an alternative to port
forwarding.</p>
<p>To copy images directly into the Minikube cluster’s local registry, do not run
the above command, but instead execute the following:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">make</span><span> k8s-load-images
</span></code></pre>
<p>This will effectively have the same end-result as port forwarding, and you
won’t have to keep the port forwarding terminal open.</p>
</blockquote>
<h2 id="build-container-images-locally">Build Container Images Locally</h2>
<p>We have a <code>make</code> target to build the container images locally.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">make</span><span> docker-build
</span></code></pre>
<h2 id="pushing-container-images-to-the-local-registry">Pushing Container Images to the Local Registry</h2>
<p>Next up, we’ll push the container images to our internal Minikube container
registry:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Make sure you port forward using 
</span><span style="color:#65737e;"># `make docker-forward-registry`
</span><span style="color:#65737e;"># before executing this command:
</span><span style="color:#bf616a;">make</span><span> docker-push
</span></code></pre>
<h2 id="docker-windows-subsystem-for-linux-integration-issues">Docker Windows Subsystem for Linux Integration Issues</h2>
<p>If <code>make docker-push</code> hangs up or gives a network error, it’s typically
related to how Docker for Windows, Windows, and Windows Subsystem for Linux
handle routing, DNS resolution, and networking.</p>
<p>One way to push container images to the Minikube cluster without adding them
to the local Minikube registry would be to run the following script:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">make</span><span> k8s-load-images
</span></code></pre>
<p>This will effectively have the same end-result as pushing the images to
the registry.</p>
<p>Alternatively, you might try pointing your terminal’s Docker CLI to the
Docker engine inside Minikube:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Set Minikube Docker environment
</span><span style="color:#96b5b4;">eval </span><span>$(</span><span style="color:#bf616a;">minikube</span><span> docker-env)
</span><span style="color:#65737e;"># Interact with Minikube&#39;s Docker Engine
</span><span style="color:#bf616a;">make</span><span> docker-build
</span><span style="color:#65737e;"># Unset Minikube Docker environment when you&#39;re done
</span><span style="color:#96b5b4;">eval </span><span>$(</span><span style="color:#bf616a;">minikube</span><span> docker-env</span><span style="color:#bf616a;"> --unset</span><span>)
</span></code></pre>
<p>For Mac OS and Linuxes, where if you get registry-access-related errors, adding
the following to <code>/etc/docker/daemon.json</code> can help:</p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  &quot;</span><span style="color:#a3be8c;">insecure-registries</span><span>&quot;: [&quot;</span><span style="color:#a3be8c;">localhost:5000</span><span>&quot;]
</span><span>}
</span></code></pre>
<p>For Docker for Mac, or Docker for Windows, you will need to update
the Docker Engine settings from the “<em>Settings &gt; Docker Engine</em>” menu as
follows:</p>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>{
</span><span>  &quot;</span><span style="color:#a3be8c;">builder</span><span>&quot;: {
</span><span>    &quot;</span><span style="color:#a3be8c;">gc</span><span>&quot;: {
</span><span>      &quot;</span><span style="color:#a3be8c;">defaultKeepStorage</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">20GB</span><span>&quot;,
</span><span>      &quot;</span><span style="color:#a3be8c;">enabled</span><span>&quot;: </span><span style="color:#d08770;">true
</span><span>    }
</span><span>  },
</span><span>  &quot;</span><span style="color:#a3be8c;">experimental</span><span>&quot;: </span><span style="color:#d08770;">false</span><span>,
</span><span>  &quot;</span><span style="color:#a3be8c;">insecure-registries</span><span>&quot;: [
</span><span>    &quot;</span><span style="color:#a3be8c;">localhost:5000</span><span>&quot;
</span><span>  ]
</span><span>}
</span></code></pre>
<p>Once the change is done, don’t forget to restart the Docker Engine.</p>
<p>That said, <code>make k8s-load-images</code> is the safest and simplest way to push
the images into Minikube without having to deal with Docker networking,
port forwarding, and Docker registry, making it the preferred method, and
it is what we recommend.</p>
<h2 id="deploying-spire-and-spike-to-the-local-cluster">Deploying SPIRE and SPIKE to the Local Cluster</h2>
<p>Once we push the container images to the registry, we can now deploy <strong>SPIRE</strong>
and <strong>SPIKE</strong>.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># Uses `./config/helm/values-dev.yaml`
</span><span style="color:#bf616a;">make</span><span> deploy-dev-local
</span></code></pre>
<h2 id="verifying-spike-deployment">Verifying SPIKE Deployment</h2>
<p>First, make sure that your components are up and running.</p>
<p>The following commands should <strong>all</strong> show <code>Ready</code> and <code>Runing</code> containers.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">kubectl</span><span> get po</span><span style="color:#bf616a;"> -n</span><span> spire-server
</span><span style="color:#65737e;"># spiffe-server-0
</span><span style="color:#65737e;"># spiffe-spiffe-oidc-discovery-provider
</span><span style="color:#bf616a;">kubectl</span><span> get po</span><span style="color:#bf616a;"> -n</span><span> spire-system
</span><span style="color:#65737e;"># spiffe-agent
</span><span style="color:#65737e;"># spiffe-spiffe-csi-driver
</span><span style="color:#bf616a;">kubectl</span><span> get po</span><span style="color:#bf616a;"> -n</span><span> spike
</span><span style="color:#65737e;"># spiffe-spike-keeper-0
</span><span style="color:#65737e;"># spiffe-spike-keeper-1
</span><span style="color:#65737e;"># spiffe-spike-keeper-2
</span><span style="color:#65737e;"># spiffe-spike-nexus-0
</span><span style="color:#65737e;"># spiffe-spike-pilot
</span></code></pre>
<p>You can also shell into <strong>SPIKE Pilot</strong> to create and retrieve secrets to
ensure <strong>SPIKE</strong> is up and running and properly configured in the cluster.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">make</span><span> exec-spike
</span><span style="color:#65737e;"># ^ This will shell into SPIKE Pilot.
</span><span style="color:#65737e;"># Now you can execute the following commands:
</span><span style="color:#bf616a;">spike</span><span> secret list
</span><span style="color:#65737e;"># Output:
</span><span style="color:#65737e;"># No Secrets found.
</span><span style="color:#bf616a;">spike</span><span> secret put test/creds username=spike password=SPIKERocks
</span><span style="color:#65737e;"># Output:
</span><span style="color:#65737e;"># OK
</span><span style="color:#bf616a;">spike</span><span> secret list
</span><span style="color:#65737e;"># Output:
</span><span style="color:#65737e;"># - test/creds
</span><span style="color:#bf616a;">spike</span><span> secret get test/creds
</span><span style="color:#65737e;"># Output:
</span><span style="color:#65737e;"># password: SPIKERocks
</span><span style="color:#65737e;"># username: spike
</span><span>
</span></code></pre>
<h2 id="you-are-all-set">You Are All Set</h2>
<p>That’s it. Now, you know how to modify <strong>SPIKE</strong>’s source code and test your
changes in a local Kubernetes cluster.</p>
<p>Next up, you might want to <a href="https://github.com/spiffe/spike" title="SPIKE on GitHub">Read <strong>SPIKE</strong>’s Source Code</a> to learn more
about <strong>SPIKE</strong>’s internals, or <a href="https://spike.ist/architecture/" title="SPIKE Architecture">learn more about <strong>SPIKE</strong>’s
architecture</a> or <a href="https://spike.ist/architecture/security-model/" title="SPIKE Security Model">security model</a>.</p>
<p>You might also want to try <a href="https://spike.ist/development/bare-metal/" title="SPIKE on Linux">building <strong>SPIKE</strong> on a bare metal
Linux</a> if you want to see how <strong>SPIKE</strong> can be used on a bare
metal Linux machine without using container orchestration such as <em>Kubernetes</em></p>
<p>&nbsp;</p>
<hr />
<ul>
<li><a href="https://spike.ist/development/local-deployment/">Deploying SPIKE Locally</a></li>
<li><a href="https://spike.ist/development/bare-metal/">SPIKE on Linux</a></li>
</ul>
<hr />
<ul>
<li><a href="https://spike.ist/about/">About</a></li>
<li><a href="https://spike.ist/community/">Community</a></li>
<li><a href="https://spike.ist/getting-started/">Getting Started</a></li>
<li><a href="https://spike.ist/usage/">Using SPIKE</a></li>
<li><a href="https://spike.ist/development/">Developing SPIKE</a></li>
<li><a href="https://spike.ist/architecture/">SPIKE Architecture</a></li>
<li><a href="https://spike.ist/tracking/">Tracking</a></li>
<li><a href="https://spike.ist/operations/">Operations</a></li>
</ul>

    
        </article>

        <footer id="footer">
            Copyright © 2024-present <strong>SPIKE Contributors</strong>.<br>
            <strong>SPIKE</strong>'s code
            is distributed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache (v2.0)</a>.
            <br>
            The documentation on this website
            is distributed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY-4.0</a>.
            <br><br>
            We <strong>do not</strong> collect your data.
            This site <strong>does not</strong> use any tracking cookies or scripts.
        </footer>
    </div>

</main>


    <script type="text/javascript" src="https://spike.ist/elasticlunr.min.js" defer></script>
    <script type="text/javascript" src="https://spike.ist/search_index.en.js" defer></script>
<script type="text/javascript" src="https://spike.ist/js.js" defer></script>
</body>
</html>
<style>
body {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;
    font-family: var(--font-family);
    background-color: var(--bg-primary);
    color: var(--text-primary);
}

main {
    width: 100vw;
    max-width: 1920px;
    display: flex;
    flex-direction: row;
    overflow: hidden;
}

#footer {
    text-align: center;
    padding: 2rem;
    font-size: 0.875rem;
    color: var(--text-muted);
    border-top: 1px solid var(--border-color);
    margin-top: 2rem;
}

.content {
    display: flex;
    flex-direction: column;
    flex: 1;
    height: 100vh;
    overflow-y: auto;
    background-color: var(--bg-primary);
    line-height: 1.6;
    border-left: 1px solid var(--border-color);
}

#footer a {
    color: var(--spike-blue);
    text-decoration: none;
    transition: all 0.2s ease;
    border-bottom: 1px solid transparent;
    font-weight: 500;

}

#footer a:hover {
    border-bottom-color: var(--spike-blue);
}

</style>